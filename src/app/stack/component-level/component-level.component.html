<fab-toast-notification [notifications]="workItemResponse"></fab-toast-notification>
<div class="component-information">
    <div *ngIf="dependenciesList.length > 0" class="table-responsive">
        <!-- Toolbar -->
        <div *ngIf="!isCompanion" class="stack-components-toolbar toolbar-pf table-view-pf-toolbar">
            <div class="col-sm-12">
                <form class="row toolbar-pf-actions">
                    <div class="form-group toolbar-pf-filter">
                        <label class="sr-only" for="filter">Name</label>
                        <div class="input-group">
                            <div (click)="handleDropDownClick(fieldContainer)" #fieldContainer class="input-group-btn">
                                <button type="button" class="btn btn-default dropdown-toggle" id="filter" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">{{currentFilter}}
                                    <span class="caret"></span>
                                </button>
                                <ul class="dropdown-menu">
                                    <li (click)="handleFilterFieldClick(fieldContainer, filter, $event)" *ngFor="let filter of filters">
                                        <a href="#">
                                            <i *ngIf="filter.class" [className]="filter.class" aria-hidden="true"></i>
                                            {{filter.name}}
                                        </a>
                                    </li>
                                </ul>
                            </div>
                            <input  placeholder="Filter by Name" #inputstring (keyup)="filter_by_name(inputstring.value)" class="filtered">                                                         
                        </div>
                    </div>
                </form>
            </div>
        </div>
        <div class="accordion-container">
            <!-- <div class="header">
                <span [className]="header.class + '-width'" *ngFor="let header of headers">{{header.name}}</span>
            </div>
            <div class="body">
                <div class="row" *ngFor="let dependency of dependenciesList">
                    <span class="medium-width">{{dependency.name}}</span>
                    <span class="small-width">{{dependency.current_version}}</span>
                    <span class="small-width">{{dependency.recommended_version}}</span>
                    <span class="small-width">{{dependency.latest_version}}</span>
                    <span class="small-width">{{dependency.isUsageOutlier}}</span>
                    <span class="small-width">{{dependency.osio_user_count}}</span>
                    <span class="small-width">{{dependency.github_user_count}}</span>
                    <span class="small-width">{{dependency.watchers}}</span>
                    <span class="small-width">{{dependency.stargazers_count}}</span>
                    <span  class="large-width" ellipsis>{{dependency.contributors}}</span>
                    <span class="small-width">{{dependency.forks_count}}</span>
                    <span class="large-width" ellipsis>{{dependency.git_stat}}</span>
                    <span ellipsis class="medium-width">
                        <span class="used-by" *ngFor="let used_by of dependency.used_by">
                            <span ellipsis>{{used_by.name}}</span>
                            <i class="fa fa-star used-by-icon" aria-hidden="true"></i>{{used_by.stars}}
                        </span>
                    </span>
                    <span ellipsis class="medium-width">{{dependency.categories}}</span>
                    <span class="small-width">{{dependency.action}}</span>
                </div>
            </div>-->
        </div> 
        <!-- Table HTML -->
         <table class="table table-striped table-bordered table-hover children-break-word" id="dependenciesTable">
            <thead>
                <tr>
                    <th [ngClass]="{'small-width': header.class === 'small', 'medium-width': header.class === 'medium', 'large-width': header.class === 'large'}"
                        (click)="handleTableOrderClick(header)" *ngFor="let header of headers">
                        {{header.name}}
                        <!--<span *ngIf="header.isSortable" class="fa {{header.sortDirectionClass || sortDirectionClass}}"></span>-->
                     </th>
                </tr>
            </thead>
            <tbody (click)="handleCollapseClick($event)" (hover)="handleHoverState($event)" *ngFor="let dependency of (dependenciesList | filter: fieldName);let i = index;trackBy: trackByFn">
                <tr [tooltip]="dependency['reason'] ? dependency['reason'] : null" class="{{dependency['parent-reference'] ? dependency['parent-reference'] : null}}"
                    [ngClass]="{'parent-class': dependency.isParent, 'child-class': dependency.isChild}" *ngIf="(this.searchInput.length === 0 || dependency.name.indexOf(this.searchInput) !== -1)">
                    <!-- <div class="col-xs-12"> -->
                    <td>
                        <span [class]="symbol[i]" (click)="toggle_td(i)"></span>
                    </td>
                    <td ellipsis data-id="{{dependency.compId}}" >
                        <span>
                            <i [ngClass]="{'fa': true, 'fa-reply relation-icon': dependency.isChild, 'fa-database': dependency.isParent || isCompanion === true, 'parent-icon': dependency.isParent, 'companion': isCompanion === true}"
                                aria-hidden="true" *ngIf="dependency.isChild || dependency.isParent || isCompanion === true"></i>
                        </span>
                        <span>
                            <i [ngClass]="{'fa': true, 'fa-database child-icon': dependency.isChild, 'usage-outlier outlier-icon': dependency.isUsageOutlier}"
                                aria-hidden="true" *ngIf="dependency.isChild || (!dependency.isChild && dependency.isUsageOutlier)"></i>
                        </span>
                        {{dependency.name}}
                    </td>
                    <td ellipsis [ngClass]="{'text-center': true, 'different-version': dependency.latest_version !== dependency.current_version}">{{dependency.current_version}}</td>
                    <td ellipsis *ngIf="!isCompanion" class="text-center">{{dependency.recommended_version}}</td>
                    <td ellipsis class="text-center">{{dependency.latest_version}}</td>
                    <td class="text-center">
                        <i title="{{dependency.has_issue ? 'CVE Score: ' + dependency.security_issue: null}}" [ngClass]="{'fa': true, 'insecure fa-ban': dependency.has_issue === true, 'secure fa-check-circle-o': dependency.has_issue === false}"
                            aria-hidden="true"></i>
                    </td>
                    <td ellipsis>
                        <i *ngIf="dependency.license_analysis && dependency.license_analysis.licensestatus && dependency.license_analysis.licensestatus.toLowerCase() === 'outlier'"
                            [ngClass]="{'fa outlier-icon': true}"></i>
                        <i *ngIf="dependency.license_analysis && dependency.license_analysis.licensestatus && dependency.license_analysis.licensestatus.toLowerCase() === 'reallyunknown'"
                            [ngClass]="{'unknown-license': true}"></i>
                        <i *ngIf="dependency.license_analysis && dependency.license_analysis.licensestatus && dependency.license_analysis.licensestatus.toLowerCase() === 'licenseconflict'"
                            [ngClass]="{'conflict-license': true}"></i>
                        <span *ngFor="let license of dependency.licenses; let i = index">
                            <span *ngIf="dependency.license_analysis && dependency.license_analysis.licensestatus && dependency.license_analysis.licensestatus.toLowerCase() === 'outlier'"
                                [ngClass]="{'outlier-license-text': isOutliedLicense(dependency, license)}">
                                {{ license }}
                            </span>
                            <span *ngIf="dependency.license_analysis && dependency.license_analysis.licensestatus && dependency.license_analysis.licensestatus.toLowerCase() === 'reallyunknown'"
                                [ngClass]="{'unknown-license-text': isUnknownLicense(dependency, license)}">
                                {{ license }}
                            </span>
                            <span *ngIf="dependency.license_analysis && dependency.license_analysis.licensestatus && dependency.license_analysis.licensestatus.toLowerCase() === 'licenseconflict'"
                                [ngClass]="{'conflict-license-text': isConflictLicense(dependency, license)}">
                                {{ license }}
                            </span>
                            <span *ngIf="isNormalLicense(dependency)">
                                {{ license }}
                            </span>
                            <span *ngIf="i < dependency.licenseCount - 1">, </span>
                        </span>
                        <div class="text-center" *ngIf="dependency && dependency.licenses && dependency.licenses.length === 0">-</div>
                    </td>
                    <td class="text-center">{{dependency.osio_user_count}}</td>
                    <td ellipsis class="github-stats">
                        <span *ngIf="dependency.github_user_count > -1">Usage Count: {{dependency.github_user_count}},</span>
                        <span *ngIf="dependency.watchers > -1">Watchers: {{dependency.watchers}},</span>
                        <span *ngIf="dependency.stargazers_count > -1">Stars: {{dependency.stargazers_count}},</span>
                        <span *ngIf="dependency.forks_count > -1">Forks: {{dependency.forks_count}},</span>
                        <span *ngIf="dependency.contributors > -1">Contributors: {{dependency.contributors}}</span>
                        <span *ngIf="!dependency.git_stat">-</span>
                    </td>
                    <td ellipsis class="top-dependencies">
                        <span class="used-by" *ngFor="let used_by of dependency.used_by">
                            <span ellipsis>{{used_by.name}}</span>
                            <i class="fa fa-star used-by-icon" aria-hidden="true"></i>{{used_by.stars}}
                        </span>
                    </td>
                    <td ellipsis>{{dependency.categories}}</td>
                    <td class="action" (click)="dependency.action && handleCreateWIclick(dependency, $event)">{{dependency.action}}</td>
                <!-- </div> -->

                    <!-- <div class="something">skfbdjkfbvjfdbvjfbvgjfhb</div> -->

            </tr>
            <tr *ngIf="showtd[i]">
                    <td id="detailview" colspan="11">
                        <div>
                            <div class="expand">
                            <div class="r1">
                                <div class="t1">
                                        <div class="get_graph">
                                                <f8-chart [data]="d1" [chartOptions]="o1" bind-configs="c1"></f8-chart></div>
                                                <div class="show_graph-i">GitHub Statistics<br />
                                                    <span class="blue">DR</span>=Dependent repositories<br />
                                                    <span class="orange">Co</span>=Contributors<br />
                                                    <span class="green">Fo</span>=Forks<br />
                                                </div>
                                </div>
                                <div class="t2"><span class="release_date">Latest release date</span>
                                    <table class="tw">
                                        <tr class="w">
                                            <td class="w1">
                                                <span class="fa fa-shield"></span>
                                            </td>
                                            <td class="w1">{{dependency.forks_count}}</td>
                                            <td class="w1">{{dependency.github_user_count}}</td>
                                            <td class="w1">{{dependency.osio_user_count}}</td>
                                        </tr>
                                        <tr>
                                            <td class="w2">security</td>
                                            <td class="w2">stars</td>
                                            <td class="w2">GitHub Usage</td>
                                            <td class="w2">OSIO Usage</td>
                                        </tr>
                                    </table>
                                </div>
                            </div>
                            </div>
                            <div class="alt"><span class="fa fa-star icon-p"></span> Alternate Component</div>
                            <div class="alternative" *ngIf = "alt_comp">
                                    <table class="table table-striped table-bordered table-hover children-break-word" id="add_info">
                                        <tbody (click)="handleCollapseClick($event)" (hover)="handleHoverState($event)" >                                                    
                                        <tr [tooltip]="dependency['reason'] ? dependency['reason'] : null" class="{{dependency['parent-reference'] ? dependency['parent-reference'] : null}}"
                                        [ngClass]="{'parent-class': dependency.isParent, 'child-class': dependency.isChild}" >
                                                <!-- <td>
                                                        <span [class]="symbol[i]" ></span>
                                                    </td> -->
                                                    <td ellipsis data-id="{{dependency.compId}}">
                                                        <span>
                                                            <i [ngClass]="{'fa': true, 'fa-reply relation-icon': dependency.isChild, 'fa-database': dependency.isParent || isCompanion === true, 'parent-icon': dependency.isParent, 'companion': isCompanion === true}"
                                                                aria-hidden="true" *ngIf="dependency.isChild || dependency.isParent || isCompanion === true"></i>
                                                        </span>
                                                        <span>
                                                            <i [ngClass]="{'fa': true, 'fa-database child-icon': dependency.isChild, 'usage-outlier outlier-icon': dependency.isUsageOutlier}"
                                                                aria-hidden="true" *ngIf="dependency.isChild || (!dependency.isChild && dependency.isUsageOutlier)"></i>
                                                        </span>
                                                        {{dependency.name}}
                                                    </td>
                                                    <td ellipsis [ngClass]="{'text-center': true, 'different-version': dependency.latest_version !== dependency.current_version}">{{dependency.current_version}}</td>
                                                    <td ellipsis *ngIf="!isCompanion" class="text-center">{{dependency.recommended_version}}</td>
                                                    <td ellipsis class="text-center">{{dependency.latest_version}}</td>
                                                    <td class="text-center">
                                                        <i title="{{dependency.has_issue ? 'CVE Score: ' + dependency.security_issue: null}}" [ngClass]="{'fa': true, 'insecure fa-ban': dependency.has_issue === true, 'secure fa-check-circle-o': dependency.has_issue === false}"
                                                            aria-hidden="true"></i>
                                                    </td>
                                                    <td ellipsis>
                                                        <i *ngIf="dependency.license_analysis && dependency.license_analysis.licensestatus && dependency.license_analysis.licensestatus.toLowerCase() === 'outlier'"
                                                            [ngClass]="{'fa outlier-icon': true}"></i>
                                                        <i *ngIf="dependency.license_analysis && dependency.license_analysis.licensestatus && dependency.license_analysis.licensestatus.toLowerCase() === 'reallyunknown'"
                                                            [ngClass]="{'unknown-license': true}"></i>
                                                        <i *ngIf="dependency.license_analysis && dependency.license_analysis.licensestatus && dependency.license_analysis.licensestatus.toLowerCase() === 'licenseconflict'"
                                                            [ngClass]="{'conflict-license': true}"></i>
                                                        <span *ngFor="let license of dependency.licenses; let i = index">
                                                            <span *ngIf="dependency.license_analysis && dependency.license_analysis.licensestatus && dependency.license_analysis.licensestatus.toLowerCase() === 'outlier'"
                                                                [ngClass]="{'outlier-license-text': isOutliedLicense(dependency, license)}">
                                                                {{ license }}
                                                            </span>
                                                            <span *ngIf="dependency.license_analysis && dependency.license_analysis.licensestatus && dependency.license_analysis.licensestatus.toLowerCase() === 'reallyunknown'"
                                                                [ngClass]="{'unknown-license-text': isUnknownLicense(dependency, license)}">
                                                                {{ license }}
                                                            </span>
                                                            <span *ngIf="dependency.license_analysis && dependency.license_analysis.licensestatus && dependency.license_analysis.licensestatus.toLowerCase() === 'licenseconflict'"
                                                                [ngClass]="{'conflict-license-text': isConflictLicense(dependency, license)}">
                                                                {{ license }}
                                                            </span>
                                                            <span *ngIf="isNormalLicense(dependency)">
                                                                {{ license }}
                                                            </span>
                                                            <span *ngIf="i < dependency.licenseCount - 1">, </span>
                                                        </span>
                                                        <div class="text-center" *ngIf="dependency && dependency.licenses && dependency.licenses.length === 0">-</div>
                                                    </td>
                                                    <td class="text-center">{{dependency.osio_user_count}}</td>
                                                    <td ellipsis class="github-stats">
                                                        <span *ngIf="dependency.github_user_count > -1">Usage Count: {{dependency.github_user_count}},</span>
                                                        <span *ngIf="dependency.watchers > -1">Watchers: {{dependency.watchers}},</span>
                                                        <span *ngIf="dependency.stargazers_count > -1">Stars: {{dependency.stargazers_count}},</span>
                                                        <span *ngIf="dependency.forks_count > -1">Forks: {{dependency.forks_count}},</span>
                                                        <span *ngIf="dependency.contributors > -1">Contributors: {{dependency.contributors}}</span>
                                                        <span *ngIf="!dependency.git_stat">-</span>
                                                    </td>
                                                    <td ellipsis class="top-dependencies">
                                                        <span class="used-by" *ngFor="let used_by of dependency.used_by">
                                                            <span ellipsis>{{used_by.name}}</span>
                                                            <i class="fa fa-star used-by-icon" aria-hidden="true"></i>{{used_by.stars}}
                                                        </span>
                                                    </td>
                                                    <td ellipsis>{{dependency.categories}}</td>
                                                    <td class="action" (click)="dependency.action && handleCreateWIclick(dependency, $event)">{{dependency.action}}</td> 
                                            
                                    </tr>
                                   </tbody>
                                </table>
                                 <div class="r1">
                                    <div class="t1">
                                        <div class="get_graph">
                                        <f8-chart [data]="d1" [chartOptions]="o1" bind-configs="c1"></f8-chart></div>
                                        <div class="show_graph">GitHub Statistics<br />
                                            <span class="blue">DR</span>=Dependent repositories<br />
                                            <span class="orange">Co</span>=Contributors<br />
                                            <span class="green">Fo</span>=Forks<br />
                                        </div>
                                    </div>
                                    <div class="t2"><span class="release_date">Latest release date</span>
                                        <table class="tw">
                                            <tr class="w">
                                                <td class="w1">
                                                    <span class="fa pficon-ok"></span>
                                                </td>
                                                <td class="w1">{{dependency.forks_count}}</td>
                                                <td class="w1">{{dependency.github_user_count}}</td>
                                                <td class="w1">{{dependency.osio_user_count}}</td>
                                            </tr>
                                            <tr>
                                                <td class="w2">security</td>
                                                <td class="w2">stars</td>
                                                <td class="w2">GitHub Usage</td>
                                                <td class="w2">OSIO Usage</td>
                                            </tr>
                                        </table>
                                    </div>
                                    <!-- <div class="n_tag">Suggest new tag(s)<span class="pficon-info"></span></div> -->
                                </div>
                                <div class="active-button">
                                    <button id="button" (click)="handleCreateWIclick(dependency, $event)">Add as Work Item</button>
                                </div>
                            </div>
                        </div>

                    </td>
                </tr>
            </tbody>
        </table>
    </div>
    <div *ngIf="dependenciesList.length === 0">No data to show</div>
</div>